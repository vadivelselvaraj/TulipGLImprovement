#!/bin/bash
if [ $# -lt 3 ]; then
    echo "--- $(basename $0) allows to copy all plugin libraries, found in"
    echo "    a hierachy of build plugins, in an already existing list of"
    echo "    plugins server directories"
    echo "usage: $(basename $0) plugins_build_top_dir plugins_server_top_dir plugin_suffix (dll|dylib|so) [arch (i386|i64) = i386]"
  exit
fi

BUILD_TOP_DIR=$1
SRV_DIR=$2
SUFFIX=$3
ARCH=i386
if [ $# -eq 4 ]; then
    ARCH=$4
fi

for PLUGIN_LIB in $(find $BUILD_TOP_DIR -name 'lib*-'@TulipVersion@.$SUFFIX)
do
  PLUGIN_LIB_NAME=$(basename $PLUGIN_LIB)
  PLUGIN_XML_NAME=${PLUGIN_LIB_NAME%.$SUFFIX}.xml
  PLUGIN_XML=$(find $SRV_DIR -name $PLUGIN_XML_NAME)
  if [ "$PLUGIN_XML" == "" ]; then
    echo Error: no directory found for $PLUGIN_LIB
    exit
  else
    echo copying $PLUGIN_LIB_NAME in $(dirname $PLUGIN_XML)/$ARCH
    if [ ! -d $(dirname $PLUGIN_XML)/$ARCH ]; then
      mkdir $(dirname $PLUGIN_XML)/$ARCH
    fi
    cp $PLUGIN_LIB $(dirname $PLUGIN_XML)/$ARCH
  fi
done

