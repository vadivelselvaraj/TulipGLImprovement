FILE(GLOB tulip_LIB_SRCS "*.cpp")

SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -D_TULIP_LIB_DIR=\"\\\"${CMAKE_INSTALL_PREFIX}/lib/\\\"\"")
INCLUDE_DIRECTORIES(../include/ ${TulipBuildInclude} ${PROJECT_SOURCE_DIR} ${ZLIB_INCLUDE_DIR})

ADD_LIBRARY (${LibTulipName} SHARED ${tulip_LIB_SRCS} ../include/tulip/TulipRelease.h)
TARGET_LINK_LIBRARIES(${LibTulipName} gzstream )
IF(WIN32)
	IF(${CMAKE_GENERATOR} MATCHES "Visual Studio") #if generating for visual studio, we assume the compiler will be vc++
		TARGET_LINK_LIBRARIES(${LibTulipName} Dbghelp)
	ENDIF(${CMAKE_GENERATOR} MATCHES "Visual Studio")
ENDIF(WIN32)

INSTALL(TARGETS ${LibTulipName}
       RUNTIME DESTINATION ${TulipBinInstallDir} COMPONENT libtulip
       LIBRARY DESTINATION ${TulipLibInstallDir} COMPONENT libtulip
       ARCHIVE DESTINATION ${TulipLibInstallDir} COMPONENT libtulip)

IF(WIN32)
  FIND_LIBRARY_GLOB(ICONV_INSTALL_PATH "iconv.dll")
  FIND_LIBRARY_GLOB(ZLIB_INSTALL_PATH "zlib1.dll")
  FIND_LIBRARY_GLOB(MINGWM_INSTALL_PATH "mingwm*.dll")
  FIND_LIBRARY_GLOB(GCC_INSTALL_PATH "libgcc_s_dw2-1.dll")
  FIND_LIBRARY_GLOB(STDCPP_INSTALL_PATH "libstdc++-*.dll")
  FIND_LIBRARY_GLOB(PTHREAD_INSTALL_PATH "pthreadGC2.dll")
  FIND_LIBRARY_GLOB(GOMP_INSTALL_PATH "libgomp-*.dll")

  WIN32_INSTALL_EXTERNAL_LIB(ICONV_INSTALL_PATH libtulip)
  WIN32_INSTALL_EXTERNAL_LIB(ZLIB_INSTALL_PATH libtulip)
  WIN32_INSTALL_EXTERNAL_LIB(MINGWM_INSTALL_PATH libtulip)
  WIN32_INSTALL_EXTERNAL_LIB(GCC_INSTALL_PATH libtulip)
  WIN32_INSTALL_EXTERNAL_LIB(STDCPP_INSTALL_PATH libtulip)
  WIN32_INSTALL_EXTERNAL_LIB(PTHREAD_INSTALL_PATH libtulip)
  WIN32_INSTALL_EXTERNAL_LIB(GOMP_INSTALL_PATH libtulip)
ENDIF()
